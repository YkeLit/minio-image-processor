http {
    server {
        listen 80;
        
        # API 服务代理
        location /api/ {
            proxy_pass http://localhost:9000;
        }

        # 控制台代理
        location /console/ {
            proxy_pass http://localhost:9001;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }

        # 图片处理接口
        location /processed/ {
            # 代理到MinIO获取原始图片
            proxy_pass http://localhost:9000/;
            proxy_set_header Host $host;
            
            # 启用图片处理模块
            image_filter resize $arg_width $arg_height;
            image_filter_jpeg_quality 85;
            image_filter_buffer 10M;
            
            # 处理错误响应
            error_page 415 = @empty;
        }

        location @empty {
            empty_gif;
        }
    }
}
events {
    worker_connections  1024;  # 单个worker进程最大连接数
    use epoll;           # 高性能模式（Linux系统建议）
    accept_mutex on;     # 优化连接分发
}
